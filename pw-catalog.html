<link rel="import" href="../polymer/polymer-element.html">
<link rel="import" href="../pw-category-card/pw-category-card.html">
<link rel="import" href="../isw-dialog/isw-dialog.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">


<dom-module id="pw-catalog">
  <template>
    <style>
      :host {
        display: block;
      }
    </style>
    
    <template is="dom-repeat" items="[[catalog]]" as="category"> 
      <div class="container">
        <pw-category-card 
          text="[[category.name]]"
          image="[[category.headerImg]]"
          items="{{category.subCategory}}">
        </pw-category-card>        
      </div>
    </template>

      <isw-dialog id="dialogRemote" name="myUniqueDialogName" data="{{dataFromRemote}}">
        <h1>[[subCategorySelected]]</h1>
        <paper-input id="inputExpenseItem" type="text" label="Gasto a realizar"></paper-input>
        <paper-button dialog-dismiss>Cancel</paper-button>
        <paper-button dialog-confirm autofocus on-tap="_addExpense">Accept</paper-button>  
      </isw-dialog>

  </template>

  <script>
    /**
     * `pw-catalog`
     * 
     *
     * @customElemen
     * @polymer
     * @demo demo/index.html
     */
    class PwCatalog extends Polymer.Element {
      static get is() { return 'pw-catalog'; }
      static get properties() {
        return {
          subCategorySelected: {
            type: String,
            value: ""
          },
          categorySelected: {
            type: String,
            value: ""
          },
          expenseItem:{type:String, value:""},
          catalog: {
            type: Array,
            value: []
          },

          expenseCount:{type:Number, value:0}  
        };
      }

      connectedCallback(){
        super.connectedCallback();
        this.addEventListener("click-item", (e)=>{
              
             this.subCategorySelected = e.detail.subCategory;
             this.categorySelected = e.detail.category;
             this._openDialog();
        });
      }

      _openDialog(){

        this.$.dialogRemote.open();
      }

   _addExpense(){

      this.expenseItem = this.$.inputExpenseItem.value;
      this.expenseCount += parseInt(this.expenseItem);
      this.dispatchEvent(new CustomEvent('dataExpenses', {
           bubbles:true,
           composed:true,
           detail:{ 
                  category:this.categorySelected,
                  subCategory:this.subCategorySelected,
                  expense:this.expenseItem,
                  expenseCount:this.expenseCount
                 }
        }));

         //limpia de input
         this.$.inputExpenseItem.value = "";
      }
    
 }

  window.customElements.define(PwCatalog.is, PwCatalog);
  </script>
</dom-module>
